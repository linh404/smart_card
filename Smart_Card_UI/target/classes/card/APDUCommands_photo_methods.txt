    /**
     * V6: Set photo data (chunked upload)
     * 
     * @param photoBase64 Base64 string of photo (max 20KB)
     * @return true if success, false otherwise
     */
    public boolean setPhotoChunked(String photoBase64) {
        try {
            if (photoBase64 == null || photoBase64.isEmpty()) {
                System.out.println("[APDUCommands] setPhotoChunked: No photo to upload");
                return true; // Nothing to do
            }

            byte[] photoBytes = photoBase64.getBytes(StandardCharsets.UTF_8);
            int totalBytes = photoBytes.length;
            
            System.out.println("[APDUCommands] setPhotoChunked: Total photo size = " + totalBytes + " bytes");

            if (totalBytes > 20 * 1024) {
                System.err.println("[APDUCommands] setPhotoChunked: Photo too large (> 20KB)");
                return false;
            }

            // Chunk size: 200 bytes per APDU (safe for T=0)
            final int CHUNK_SIZE = 200;
            int totalChunks = (totalBytes + CHUNK_SIZE - 1) / CHUNK_SIZE;

            System.out.println("[APDUCommands] setPhotoChunked: Sending in " + totalChunks + " chunks...");

            for (int chunkIndex = 0; chunkIndex < totalChunks; chunkIndex++) {
                int offset = chunkIndex * CHUNK_SIZE;
                int chunkLen = Math.min(CHUNK_SIZE, totalBytes - offset);

                // Build APDU data: [chunkIndex(2)] [totalChunks(2)] [chunkData]
                byte[] data = new byte[4 + chunkLen];
                data[0] = (byte) (chunkIndex >> 8);
                data[1] = (byte) (chunkIndex & 0xFF);
                data[2] = (byte) (totalChunks >> 8);
                data[3] = (byte) (totalChunks & 0xFF);
                System.arraycopy(photoBytes, offset, data, 4, chunkLen);

                // Send chunk
                ResponseAPDU resp = send(INS_SET_PHOTO, (byte) 0, (byte) 0, data, 1);
                int sw = resp.getSW();

                if (sw != 0x9000) {
                    System.err.println("[APDUCommands] setPhotoChunked: Chunk " + chunkIndex + 
                        " failed with SW: " + String.format("0x%04X", sw));
                    return false;
                }

                // Progress
                if ((chunkIndex + 1) % 10 == 0 || chunkIndex == totalChunks - 1) {
                    System.out.println("[APDUCommands] setPhotoChunked: Progress: " + 
                        (chunkIndex + 1) + "/" + totalChunks + " chunks");
                }
            }

            System.out.println("[APDUCommands] setPhotoChunked: ✓ Photo uploaded successfully!");
            return true;

        } catch (Exception e) {
            System.err.println("[APDUCommands] setPhotoChunked: Exception - " + e.getMessage());
            e.printStackTrace();
            return false;
        }
    }

    /**
     * V6: Get photo data from card
     * 
     * @return Base64 string of photo, or null if error/no photo
     */
    public String getPhoto() {
        try {
            System.out.println("[APDUCommands] getPhoto: Requesting photo from card...");

            ResponseAPDU resp = send(INS_GET_PHOTO, (byte) 0, (byte) 0, null, 252);
            int sw = resp.getSW();

            if (sw != 0x9000) {
                System.err.println("[APDUCommands] getPhoto: Failed with SW: " + String.format("0x%04X", sw));
                return null;
            }

            byte[] data = resp.getData();
            if (data == null || data.length < 2) {
                System.out.println("[APDUCommands] getPhoto: No photo data returned");
                return null;
            }

            // Parse: [photoLength(2)] [photoData]
            int photoLen = ((data[0] & 0xFF) << 8) | (data[1] & 0xFF);
            
            if (photoLen == 0) {
                System.out.println("[APDUCommands] getPhoto: No photo stored on card");
                return null;
            }

            System.out.println("[APDUCommands] getPhoto: Photo length = " + photoLen + " bytes");

            // Extract photo data (skip 2-byte length header)
            int dataLen = data.length - 2;
            byte[] photoBytes = new byte[dataLen];
            System.arraycopy(data, 2, photoBytes, 0, dataLen);

            String photoBase64 = new String(photoBytes, 0, Math.min(photoLen, dataLen), StandardCharsets.UTF_8);
            System.out.println("[APDUCommands] getPhoto: ✓ Photo retrieved (" + photoBase64.length() + " chars)");

            return photoBase64;

        } catch (Exception e) {
            System.err.println("[APDUCommands] getPhoto: Exception - " + e.getMessage());
            e.printStackTrace();
            return null;
        }
    }
